============================================================
  QuantOS â€“ AI Crawler Context
  Projekttyp: Desktop Quant-Trading-Terminal
  Version:    1.1.0
============================================================


ÃœBERSICHT
---------
QuantOS ist ein lokal laufendes Quant-Trading-Terminal, gebaut
als Electron-Desktop-App. Das Backend ist eine FastAPI-Anwendung
(Python), die Marktdaten Ã¼ber die Alpaca Markets API abruft und
Backtests berechnet. Das Frontend ist reines Vanilla JS/HTML,
gerendert im Electron-Fenster. Charts werden mit Plotly.js
dargestellt, das Panel-Layout verwendet Split.js.


TECH STACK
----------
Layer       | Technologie
------------|----------------------------------------------
Desktop     | Electron 33 (Node.js)
Backend     | Python, FastAPI, Uvicorn
Datenabruf  | Alpaca Markets API (alpaca-py)
Berechnung  | pandas, numpy
Frontend    | Vanilla JS, HTML, CSS
Charts      | Plotly.js (CDN)
Layout      | Split.js (npm)
Kommunik.   | REST (fetch) â€“ Frontend â†’ Backend localhost:8000
Cache       | LocalStorage (QuantCache.js) â€“ API-Keys & Settings


ORDNERSTRUKTUR (NEU: MODULARISIERT)
------------------------------------
QuantTERMINAL_OS/
â”‚
â”œâ”€â”€ electron/
â”‚   â”œâ”€â”€ main.js         â†’ Electron Entry Point, erstellt BrowserWindow,
â”‚   â”‚                     startet Python-Backend als Child Process
â”‚   â””â”€â”€ preload.js      â†’ Electron Preload Script
â”‚
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ index.html      â†’ Haupt-HTML, lÃ¤dt app.js und style.css
â”‚   â”‚
â”‚   â”œâ”€â”€ pages/          â†’ MODULARISIERT: Jede Seite hat eigenen Ordner
â”‚   â”‚   â”œâ”€â”€ home/
â”‚   â”‚   â”‚   â”œâ”€â”€ home.html    â†’ HTML-Template fÃ¼r Homescreen
â”‚   â”‚   â”‚   â”œâ”€â”€ home.css     â†’ Page-spezifisches Styling
â”‚   â”‚   â”‚   â””â”€â”€ home.js      â†’ initHome(), API-Key-Warning, Modul-Karten
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ backtest/
â”‚   â”‚   â”‚   â”œâ”€â”€ backtest.html â†’ HTML-Template (Split-Panels, Chart, Controls)
â”‚   â”‚   â”‚   â”œâ”€â”€ backtest.css  â†’ Page-spezifisches Styling
â”‚   â”‚   â”‚   â””â”€â”€ backtest.js   â†’ runBacktest(), renderChart(), renderEquity()
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ synchro/
â”‚   â”‚   â”‚   â”œâ”€â”€ synchro.html â†’ HTML-Template (API-Keys, Cache Reset)
â”‚   â”‚   â”‚   â”œâ”€â”€ synchro.css  â†’ Page-spezifisches Styling
â”‚   â”‚   â”‚   â””â”€â”€ synchro.js   â†’ initSynchro(), _saveApiKeys(), _resetPartial/Full()
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ market/
â”‚   â”‚   â”‚   â”œâ”€â”€ market.html  â†’ HTML-Template (Market Dashboard)
â”‚   â”‚   â”‚   â”œâ”€â”€ market.css   â†’ Page-spezifisches Styling
â”‚   â”‚   â”‚   â””â”€â”€ market.js    â†’ initMarket() (in development)
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ data/
â”‚   â”‚       â”œâ”€â”€ data.html    â†’ HTML-Template (Data Management)
â”‚   â”‚       â”œâ”€â”€ data.css     â†’ Page-spezifisches Styling
â”‚   â”‚       â””â”€â”€ data.js      â†’ initData() (in development)
â”‚   â”‚
â”‚   â”œâ”€â”€ shared/         â†’ GLOBAL: Shared Components & Utils
â”‚   â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â”‚   â””â”€â”€ global.css   â†’ Base Styles, Colors, Layout, Dark Theme
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â”‚   â”œâ”€â”€ app.js       â†’ Core: SPA Navigation (navigateTo), loadPage(),
â”‚   â”‚   â”‚   â”‚                  Sidebar toggle, page init dispatcher
â”‚   â”‚   â”‚   â”œâ”€â”€ api.js       â†’ API Client: apiHealth, apiModules, apiBacktest,
â”‚   â”‚   â”‚   â”‚                  apiSymbols (fetch-Wrapper fÃ¼r Backend)
â”‚   â”‚   â”‚   â”œâ”€â”€ cache.js     â†’ QuantCache: LocalStorage-Manager fÃ¼r API-Keys,
â”‚   â”‚   â”‚   â”‚                  saveApi(), load(), resetPartial(), resetFull()
â”‚   â”‚   â”‚   â””â”€â”€ symbols.js   â†’ Symbol Browser Modal: Suche, Filterung, Auswahl
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ components/
â”‚   â”‚       â””â”€â”€ sidebar.html â†’ Sidebar Navigation (injected in index.html)
â”‚   â”‚
â”‚   â””â”€â”€ assets/         â†’ Bilder, Icons, Fonts (falls benÃ¶tigt)
â”‚
â”œâ”€â”€ backend/
â”‚   â””â”€â”€ main.py         â†’ FastAPI App, alle API-Endpunkte:
â”‚                         POST /api/health  â†’ validiert Alpaca API-Keys
â”‚                         GET  /api/modules â†’ listet Indikatoren & Strategien
â”‚                         GET  /api/symbols â†’ alle handelbare Symbole
â”‚                         POST /api/backtest â†’ fÃ¼hrt Backtest aus, gibt
â”‚                                              Chart, Equity, Performance zurÃ¼ck
â”‚
â”œâ”€â”€ indicators/         â†’ PLUGIN-SYSTEM: jede .py-Datei wird automatisch geladen
â”‚   â”œâ”€â”€ __init__.py     â†’ exportiert load_all() Hilfsfunktion
â”‚   â”œâ”€â”€ sma.py          â†’ Simple Moving Average  â†’ schreibt "sma_{period}" Spalte
â”‚   â””â”€â”€ rsi.py          â†’ Relative Strength Index â†’ schreibt "rsi" Spalte
â”‚
â”œâ”€â”€ strategies/         â†’ PLUGIN-SYSTEM: jede .py-Datei wird automatisch geladen
â”‚   â”œâ”€â”€ __init__.py     â†’ exportiert load_all() Hilfsfunktion
â”‚   â””â”€â”€ sma_cross.py    â†’ SMA-Crossover-Strategie â†’ schreibt "signal" Spalte
â”‚                         (1 = Long, -1 = Short, 0 = neutral)
â”‚
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ config.py       â†’ ALPACA_API_KEY, ALPACA_SECRET_KEY (lokal, nicht committen)
â”‚   â””â”€â”€ symbols.py      â†’ get_all_symbols() â€“ strukturierte Symbol-Liste
â”‚                         (Aktien, ETFs, Crypto, Indizes) fÃ¼r den Symbol-Browser
â”‚
â”œâ”€â”€ package.json        â†’ Electron-Projekt, main: electron/main.js
â”‚                         dependencies: split.js
â”‚                         devDependencies: electron, electron-builder
â””â”€â”€ AI_CONTEXT.txt      â†’ Diese Datei


FRONTEND â€“ SPA NAVIGATION (app.js)
-----------------------------------
navigateTo(pageName) â†’ Hauptfunktion fÃ¼r Page-Switching
  1. Versteckt alle .page Elemente
  2. Zeigt #page-{pageName} an
  3. LÃ¤dt HTML via loadPage() falls nicht cached
  4. Ruft page-spezifische init-Funktion auf (initHome, initBacktest, etc.)
  5. Setzt Sidebar collapsed/expanded State pro Page

loadPage(pageName) â†’ LÃ¤dt HTML/CSS/JS dynamisch
  1. fetch(`frontend/pages/{pageName}/{pageName}.html`)
  2. Injiziert HTML in #page-{pageName}
  3. Dynamisches CSS-Loading via <link> in <head>
  4. Dynamisches JS-Loading via <script> append


CACHE-SYSTEM (QuantCache.js)
-----------------------------
LocalStorage-basierter Cache fÃ¼r:
- API-Keys (Alpaca Key & Secret)
- User Settings (kÃ¼nftig: Layout-PrÃ¤ferenzen, etc.)

API:
  QuantCache.saveApi({ alpacaKey, alpacaSecret })
  QuantCache.load() â†’ { api: { alpacaKey, alpacaSecret } }
  QuantCache.resetPartial() â†’ lÃ¶scht Settings, behÃ¤lt API-Keys
  QuantCache.resetFull() â†’ lÃ¶scht ALLES inkl. API-Keys

API-Keys werden beim Backend-Call via POST /api/health validiert.
UngÃ¼ltige Keys werden NICHT gespeichert.


SEITEN-ÃœBERSICHT
----------------
Seite       | Status      | Beschreibung
------------|-------------|----------------------------------------------
Home        | âœ… Aktiv    | Modul-Karten-Ãœbersicht, API-Key-Warning
Backtest    | âœ… Aktiv    | Haupt-Backtesting-Interface (Charts, Controls)
Synchro     | âœ… Aktiv    | Data & Synchro: API-Keys, Cache Reset
Market      | ğŸš§ Dev      | Market Dashboard (in Entwicklung)
Data        | ğŸš§ Dev      | Data Management (in Entwicklung)


SYNCHRO PAGE (Data & Synchro)
------------------------------
Features:
- API-Key Input & Validation (Alpaca Markets)
- API-Status-Badge (âœ… konfiguriert / âš  keine Keys)
- Partial Reset: LÃ¶scht Settings, behÃ¤lt API-Keys
- Full Reset: LÃ¶scht ALLES inkl. API-Keys

UI-Elemente:
- .api-status-badge â†’ zeigt Key-Status mit farbigen Icons
- .synchro-notification â†’ zeigt Success/Error Messages
- .reset-card â†’ Cards fÃ¼r Partial/Full Reset

Icons:
- âš  (Unicode U+26A0) wird per CSS eingefÃ¤rbt (#ffa726)
- Emojis (âš ï¸ mit Variation Selector) werden NICHT verwendet,
  da sie vom OS gerendert werden und nicht per CSS fÃ¤rbbar sind


DATENFLUSS â€“ BACKTEST
---------------------
1. User stellt Parameter ein (Symbol, Timeframe, Datum, Kapital,
   Strategie, Indikatoren) im Controls-Panel (frontend)

2. runBacktest() in backtest.js sendet POST /api/backtest
   mit BacktestRequest JSON

3. backend/main.py:
   a) Mappt Symbol (z.B. ^GSPC â†’ SPY) und Timeframe
   b) Ruft OHLCV-Daten via Alpaca ab (Stock oder Crypto Client)
   c) Wendet aktive Indikatoren auf den DataFrame an
   d) FÃ¼hrt die gewÃ¤hlte Strategie aus â†’ erzeugt "signal"-Spalte
   e) Berechnet position, returns, strat_ret, equity, bh_equity
   f) Berechnet Potential Equity Zone (equity_high / equity_low)
   g) Berechnet Equity-Projektion (Upper/Lower/Mid Band)
   h) Berechnet Performance-Metriken (Sharpe, Drawdown, Win Rate, etc.)
   i) Gibt chart{}, equity{}, performance{} zurÃ¼ck

4. Frontend rendert:
   - renderChart()       â†’ Candlestick + Indikator-Overlays (Plotly)
   - renderEquity()      â†’ Equity Curve, B&H, Potential Zone, Projektion
   - renderPerformance() â†’ 8 Metrik-Boxen im Performance-Panel


PLUGIN-SYSTEM (Indikatoren & Strategien)
-----------------------------------------
backend/main.py lÃ¤dt beim Start automatisch alle .py-Dateien aus
indicators/ und strategies/ via importlib.import_module().

Bedingung: Der Dateiname muss identisch mit dem Funktionsnamen sein.
Beispiel:  indicators/macd.py  muss Funktion def macd(df, ...) enthalten

Indikatoren:  erhalten DataFrame, geben DataFrame zurÃ¼ck (neue Spalten hinzufÃ¼gen)
Strategien:   erhalten DataFrame, mÃ¼ssen df["signal"] Spalte setzen
              (1=Long, -1=Short, 0=neutral), geben DataFrame zurÃ¼ck

Neue Plugins erscheinen automatisch in GET /api/modules und damit
im Frontend (Dropdown / Checkbox).


PERFORMANCE-METRIKEN (backend/main.py)
--------------------------------------
Metrik          | Berechnung
----------------|--------------------------------------------------
Total Return    | (end_equity / capital - 1) * 100
B&H Return      | (end_bh_equity / capital - 1) * 100
Sharpe Ratio    | (mean(strat_ret) / std(strat_ret)) * sqrt(252)
Max Drawdown    | min((equity - cummax(equity)) / cummax(equity)) * 100
Win Rate        | wins / (wins + losses) * 100
Total Trades    | wins + losses (Perioden mit non-zero return)
Profit Factor   | gross_profit / abs(gross_loss)
Calmar Ratio    | total_return / abs(max_drawdown)


FRONTEND â€“ PANEL-LAYOUT (Split.js)
------------------------------------
Vertikale Splits (nur Backtest-Page):
  [perf-panel 15%] | [backtest-body 85%]
  [chart-panel 65%] | [equity-panel 35%]

Horizontaler Split:
  [panels-container 78%] | [controls-panel 22%]

Alle Panels sind per Drag resizable. Performance-Panel hat
automatisch berechnetes min/maxHeight basierend auf Box-Anzahl.


STYLING-SYSTEM (Catppuccin Dark Theme)
---------------------------------------
Global Colors (aus global.css):
  --bg-primary:   #0a0a14  â†’ Haupt-Hintergrund
  --bg-secondary: #1a1a2e  â†’ Cards, Panels
  --bg-tertiary:  #2a2a3e  â†’ Borders, Dividers
  --text-primary: #cdd6f4  â†’ PrimÃ¤rer Text
  --text-muted:   #6c7086  â†’ SekundÃ¤rer Text
  --accent-blue:  #7aa2f7  â†’ Buttons, Links
  --accent-green: #26a69a  â†’ Success
  --accent-red:   #ef5350  â†’ Error
  --accent-orange:#ffa726  â†’ Warning

Page-spezifisches CSS liegt in frontend/pages/{page}/{page}.css
Shared Styles (Layout, Typography, Buttons) in frontend/shared/css/global.css


BEKANNTE OFFENE PUNKTE (Stand Feb 2026)
----------------------------------------
- strategies/sma_cross.py: Import-Bug (Modul statt Funktion)
- RSI-Daten werden vom Backend gesendet aber nicht im Chart gerendert
- indicator_cols filtert nur sma_ und ema_ PrÃ¤fixe
- slow_period ist hardcoded auf 50 (nicht konfigurierbar)
- Short-Signale (-1) werden durch .clip(lower=0) ignoriert
- Math.min/max mit Spread-Operator kann bei langen Zeitreihen crashen
- Market & Data Pages sind noch nicht implementiert
- Symbol-Browser Modal hat keine Keyboard-Navigation (Enter zum BestÃ¤tigen)


ENTWICKLUNGS-GUIDELINES
------------------------
1. Neue Seiten: Erstelle Ordner in frontend/pages/{name}/ mit .html/.css/.js
2. Page Init: FÃ¼ge init{Name}() Funktion hinzu und registriere in app.js
3. Styling: Page-spezifisch in {name}.css, Shared in global.css
4. API-Calls: Nutze Wrapper aus api.js, KEINE direkten fetch() Calls
5. Cache: Nutze QuantCache fÃ¼r persistente Daten, NICHT direkt localStorage
6. Icons: Verwende Unicode-Zeichen (âš  U+26A0) statt Emojis fÃ¼r CSS-Kontrolle
7. Navigation: IMMER navigateTo() verwenden, NIEMALS direkt DOM manipulieren
8. Performance: Lazy-Loading fÃ¼r Pages, nur aktive Page ist im DOM


DEPLOYMENT
----------
Entwicklung:
  1. Backend starten: cd backend && uvicorn main:app --reload
  2. Electron starten: npm start

Production Build:
  npm run build â†’ erstellt Installer fÃ¼r macOS/Windows/Linux
